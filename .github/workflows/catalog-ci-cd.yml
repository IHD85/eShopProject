# Navn på workflowet, som vises i GitHub Actions
name: CI Build - Catalog.API (.NET)

on:
  # Kør dette workflow, når der oprettes/opdateres en Pull Request til 'main'
  pull_request:
    branches: [ main ]
    # VIGTIGT: Kør KUN hvis der er ændringer i Catalog.API's mappe
    paths:
      - 'Microservices/Catalog/Catalog.API/**'
      - '.github/workflows/catalog-ci-cd.yml' # Kør også, hvis vi ændrer denne fil
  
  # Tillad at man kan starte workflowet manuelt fra Actions-fanen
  workflow_dispatch:

jobs:
  # Et enkelt job vi kalder "build-dotnet"
  build-dotnet:
    # Kør på en standard Ubuntu-maskine
    runs-on: ubuntu-latest

    # Trinene i jobbet
    steps:
      # Trin 1: Hent din kode ned til maskinen
      - name: Check out repository
        uses: actions/checkout@v4

      # Trin 2: Sæt .NET 8 SDK'en op på maskinen
      - name: Setup .NET
        uses: actions/setup-dotnet@v4
        with:
          dotnet-version: '8.x' # Sæt til den .NET version du bruger

      # Trin 3: Kør 'dotnet restore' på projektet
      # Den finder og gendanner alle NuGet-pakker
      - name: Restore dependencies
        run: dotnet restore Microservices/Catalog/Catalog.API/Catalog.API.csproj

      # Trin 4: Byg selve projektet
      # --no-restore fordi vi lige har kørt restore
      - name: Build project
        run: dotnet build Microservices/Catalog/Catalog.API/Catalog.API.csproj --no-restore
